keyWord:
  step:
    - name: 合约体验金券列表
      url: /welfare/welfare_coupon/page
      headers:
        Token: ${token}
      method: GET
      variables:
        current: 1
        size: 10
        couponType: experience
      assertion: [ json: { $.code: '0' } ]
      extractor:
        - json:
            coupon_id: $.data.records[0].id
    - name: 激活体验金券
      url: /welfare/welfare_coupon/activate_coupon
      headers:
        Token: ${token}
      method: POST
      body: |
        {"couponId":${coupon_id}}
      assertion: [json: {$.code: '0'}]
    - name: 发放体验金优惠券
      host: ${spotAdmin_host}
      url: /api/welfare/coupon/grant/manual
      headers:
        Token: ${spotAdminUserId}
      method: POST
      body: |
        {"configId":${couponId},"uidStr":"${__uidIdToShowId(${userId})}"}
      assertion: [ json: { $.code: '0' } ]
    - name: 生成邀请链接
      url: /web/api/welfare/rebate/generate_link_code
      headers:
        Token: ${token}
      method: POST
      body: |
        {"shareRatio":${__groovy(${__Random(0,20)}/100,shareRatio)},"myRatio":${__groovy(0.2-${shareRatio},)},"defaultSelect":1,"remark":""}
      assertion: [ json: { $.code: '0' } ]
    - name: 邀请链接列表
      url: /web/api/welfare/rebate/link_list
      untilWait: 10
      headers:
        Token: ${token}
      method: GET
      assertion: [ json: { $.code: '0' } ]
      extractor:
        - json:
            link_code: $.data[?(@.defaultSelect==1)].code
    - name: 我的邀请链接
      url: /web/api/welfare/rebate/get_count
      headers:
        Token: ${token}
      method: GET
      assertion: [ json: { $.code: '0' } ]
    - name: 推荐记录
      url: /web/api/welfare/rebate/share_list
      variables:
        startDate: ${__PlusDay(yyyy-MM-dd,-6,)}T00:00:00Z
        endDate: ${__PlusDay(yyyy-MM-dd,1,)}T00:00:00Z
        pageSize: 10
        pageNo: 1
      headers:
        Token: ${token}
      method: GET
      assertion: [ json: { $.code: '0' } ]
    - name: 返佣记录
      url: /web/api/welfare/rebate/rebate_list
      variables:
        startDate: ${__PlusDay(yyyy-MM-dd,-6,)}T00:00:00Z
        endDate: ${__PlusDay(yyyy-MM-dd,1,)}T00:00:00Z
        pageSize: 10
        pageNo: 1
      headers:
        Token: ${token}
      method: GET
      assertion: [ json: { $.code: '0' } ]
    - name: 我的返佣比例
      url: /web/api/welfare/rebate/invite_rank
      headers:
        Token: ${token}
      method: GET
      assertion: [ json: { $.code: '0' } ]
    - name: 获取默认邀请链接
      url: /web/api/welfare/rebate/get_default_invite
      headers:
        Token: ${token}
      method: GET
      assertion: [ json: { $.code: '0' } ]
      extractor:
        - json:
            link_code: $.data.inviteCode
    - name: 返佣统计
      url: /web/api/welfare/rebate/over_view
      headers:
        Token: ${token}
      method: GET
      assertion:
        - json:
            $.data.totalShareNum: 1
    - name: 普通邀请返佣发放
      url: /welfare/inner/v1/welfare/rebateSettlement
      variables:
        queryStartDate: ${__groovy(${__time()} - 24 * 60 * 60 * 1000)}
        queryEndDate: ${__time()}
      method: GET